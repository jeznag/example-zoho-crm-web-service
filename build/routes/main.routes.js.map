{"version":3,"sources":["../../src/routes/main.routes.js"],"names":["express","Zoho","_","request","chalk","bodyParser","router","Router","Token","crm","CRM","authtoken","jsonParser","json","urlencodedParser","urlencoded","extended","get","req","res","send","post","dataResp","result","firstName","body","contact_first_name","lastName","contact_last_name","email","contact_email","phone","contact_phone","description","contact_description","myXMLText","url","method","headers","error","response","contactId","JSON","parse","hasOwnProperty","recorddetail","FL","forEach","value","val","content","successfully_created","contact_id","caseDescription","case_description","caseSubject","case_subject","caseStatus","case_status","caseOrigin","case_origin","emailEjecutivo","case_email_ejecutivo","caseID","case_id","params","phone_number","statusCode","Contacts","row","already_exists","getRecords","err","data"],"mappings":"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","file":"main.routes.js","sourcesContent":["import express from 'express';\nimport Zoho from 'zoho';\nimport _ from 'lodash';\nimport request from 'request';\nimport chalk from 'chalk';\nimport bodyParser from 'body-parser'\n\nconst router = express.Router();\nconst Token = 'INSERT TOKEN HERE';\nconst crm = new Zoho.CRM({\n    authtoken: Token\n});\n\n// create application/json parser \nvar jsonParser = bodyParser.json()\n \n// create application/x-www-form-urlencoded parser \nvar urlencodedParser = bodyParser.urlencoded({ extended: false })\n\nrouter.get('/', (req, res) => {\n    res.send('index')\n});\n\nrouter.post('/contact/create', jsonParser, function (req, res) {\n    let dataResp = {}\n    let result = {}\n\n    const firstName = req.body.contact_first_name\n    const lastName = req.body.contact_last_name\n    const email = req.body.contact_email\n    const phone = req.body.contact_phone\n    const description = req.body.contact_description\n\n    const myXMLText = `<Contacts>\n    <row no=\"1\">\n    <FL val=\"First Name\">`+firstName+`</FL>\n    <FL val=\"Last Name\">`+lastName+`</FL>\n    <FL val=\"Email\">`+email+`</FL>\n    <FL val=\"Phone\">`+phone+`</FL>\n    <FL val=\"Description\">`+description+`</FL>\n    </row>\n    </Contacts>`\n\n    request({\n        url: \"https://crm.zoho.com/crm/private/json/Contacts/insertRecords?authtoken=\"+Token+\"&scope=crmapi&xmlData=\"+myXMLText,\n        method: \"POST\",\n        headers: {\n            \"content-type\": \"application/xml\"\n        },\n        body: myXMLText\n    }, function (error, response, body){\n        let contactId = ''\n        dataResp = JSON.parse(body)\n        if(dataResp.response.hasOwnProperty(\"result\")){\n            dataResp = dataResp.response.result.recorddetail\n            _(dataResp.FL).forEach(function(value) {\n                if(value.val == 'Id'){\n                    contactId = value.content\n                }\n            });\n            result = {\n                successfully_created : true,\n                contact_id : contactId\n             }\n        }else{\n            result = {\n                successfully_created : false,\n             }\n        }\n        res.send(result);\n    });\n});\n\nrouter.post('/case/create', jsonParser, function (req, res) {\n    let dataResp = {}\n    let result = {}\n\n    const contactId = req.body.contact_id\n    const caseDescription = req.body.case_description\n    const caseSubject = req.body.case_subject\n    const caseStatus = req.body.case_status\n    const caseOrigin = req.body.case_origin\n    const emailEjecutivo = req.body.case_email_ejecutivo\n\n    const myXMLText = `<Cases>\n    <row no=\"1\">\n    <FL val=\"Case Origin\">${caseOrigin}</FL>\n    <FL val=\"Status\">${caseStatus}</FL>\n    <FL val=\"Subject\">${caseSubject}</FL>\n    <FL val=\"Description\">${caseDescription}</FL>\n    <FL val=\"Email Ejecutivo\">${emailEjecutivo}</FL>\n    <FL val=\"WHOID\">${contactId}</FL> \n    </row>\n    </Cases>`\n\n    request({\n        url: \"https://crm.zoho.com/crm/private/json/Cases/insertRecords?authtoken=\"+Token+\"&scope=crmapi&xmlData=\"+myXMLText,\n        method: \"POST\",\n        headers: {\n            \"content-type\": \"application/xml\"\n        },\n        body: myXMLText\n    }, function (error, response, body){\n        let caseID = ''\n        dataResp = JSON.parse(body)\n        if(dataResp.response.hasOwnProperty(\"result\")){\n            dataResp = dataResp.response.result.recorddetail\n            _(dataResp.FL).forEach(function(value) {\n                if(value.val == 'Id'){\n                    caseID = value.content\n                }\n            });\n            result = {\n                successfully_created : true,\n                case_id : caseID\n            }\n        }else{\n            result = {\n                successfully_created : false,\n                error: body\n            }\n        }\n        res.send(result);\n    });\n});\n\nrouter.get('/contact/:phone_number', (req, res) => {\n    let dataResp = {}\n    let result = {}\n\n    request('https://crm.zoho.com/crm/private/json/Contacts/searchRecords?authtoken='+Token+'&scope=crmapi&criteria=(Mobile:'+req.params.phone_number+')', function (error, response, body) {\n      if (!error && response.statusCode == 200) {\n        dataResp = JSON.parse(body)\n        if(dataResp.response.hasOwnProperty(\"result\")){\n            let contactId = ''\n            dataResp = dataResp.response.result.Contacts.row\n            _(dataResp.FL).forEach(function(value) {\n                if(value.val == 'CONTACTID'){\n                    contactId = value.content\n                }\n            });\n            result = {\n                already_exists : true,\n                contact_id : contactId\n            }\n        } else {\n            result = {\n                already_exists : false\n            }\n        }\n      }\n      res.json(result)\n    })\n});\n\nrouter.get('/contactlist', (req, res) => {\n    let dataResp = []\n    crm.getRecords('contacts', function (err, data) {\n          if (err) {\n            dataResp = err\n          }else{\n            dataResp = data\n            dataResp = dataResp.data\n          }  \n          res.json({\"data\":dataResp})\n    });\n});\n\n\nexport default router;\n"]}